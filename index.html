<!DOCTYPE html>

<head>
	<title>Fret Mapper</title>
	<link rel="stylesheet" type="text/css" href="style.css"/>

</head>


<body onload="init()">
	<div id="container">
		<div id="window">
			<img src="img/strat.png" id="guitar"></img>
			<div class="fretMark" id="parent"></div></div>
		
		<div id="control">
		<button onclick="zoom(1440)">zoom</button>
		<button onclick="markSet([[5,1],[3,2],[2,3]])">C Chord</button>
		<button onclick="markSet([[5,2],[4,2],[3,2]])">A Chord</button>
		<button onclick="markSet([[6,3],[2,2],[1,3]])">G Chord</button>
		<button onclick="markSet([[4,1],[3,2],[2,2]])">E Chord</button>
		<button onclick="markSet([[6,3],[5,2],[4,3]])">D Chord</button>
		
		<button onclick="markSet([[1,3], [1,5],[1,7],[1,9],[1,12]])">test</button>
		</div>
	</div>

</body>

<script>
var BRIDGE_POS = 0.167
var NUT_POS = 0.797

function init() {
	var img = document.getElementById("guitar");
	img.style.width = "1440px";
	img.style.left = "0px";
	img.style.top = "0px";
	var mark = document.getElementById("parent");
	mark.style.width = "0px";
}

// height of img is 3/8 the width
function format(input) {return input.toString().concat("px");}

function cleanup() {
	var markers = document.getElementById("window").querySelectorAll("#child");
	for (var i = 0; i < markers.length; i++) {
		document.getElementById("window").removeChild(markers[i]);
	}
}

function zoom(width) {
	cleanup();
	var img = document.getElementById("guitar");
	img.style.width = format(width);
	img.style.left = format((1440 - width) / 2);
	img.style.top = format((540 - width * 3/8) / 2);
}

function fretPos(fret) {
	return BRIDGE_POS + (NUT_POS - BRIDGE_POS) / (Math.pow(2, fret / 12));
}
function markFret(string, fret) {
	var mark = document.getElementById("parent").cloneNode(false);
	var guitar = document.getElementById("guitar");
	var width = parseFloat(guitar.style.width);
	var left = parseFloat(guitar.style.left);
	var top = parseFloat(guitar.style.top);
	mark.id = "child";
	document.getElementById("window").appendChild(mark);
		
	mark.style.width = format(width*0.007);
	mark.style.height = format(width*0.007);
	
	var newLeft = width * ((fretPos(fret - 1) + fretPos(fret)) / 2)
	var offset = (document.getElementById("window").childElementCount - 3) * parseFloat(mark.previousSibling.style.width);
	
	var noteVal = -1;
	
	switch (string) {
	case 1: 
		mark.style.top = format(top - offset + (width * -0.0035) + width * 3/8 * (-0.58 + newLeft / width * 0.035)); 
		noteVal = 0;
		break;
	case 2: 
		mark.style.top = format(top - offset + (width * -0.0035) + width * 3/8 * (-0.548 + newLeft / width * 0.022)); 
		noteVal = 5;
		break;
	case 3: 
		mark.style.top = format(top - offset + (width * -0.0035) + width * 3/8 * (-0.519 + newLeft / width * 0.007)); 
		noteVal = 10;
		break;
	case 4: 
		mark.style.top = format(top - offset + (width * -0.0035) + width * 3/8 * (-0.489 + newLeft / width * -0.007)); 
		noteVal = 15;
		break;
	case 5: 
		mark.style.top = format(top - offset + (width * -0.0035) + width * 3/8 * (-0.459 + newLeft / width * -0.022)); 
		noteVal = 19;
		break;
	case 6: 
		mark.style.top = format(top - offset + (width * -0.0035) + width * 3/8 * (-0.429 + newLeft / width * -0.036)); 
		noteVal = 24;
		break;
	default: break;
	}
	
	mark.style.left = format(left + (width * -0.0035) + newLeft);
	
	/*noteVal = noteVal + fret;
	
	if (noteVal < 0)
		mark.style.boxShadow = "0px 0px 3px #000";
	else if (noteVal < 12)
		mark.style.boxShadow = "0px 0px 3px #a00";
	else if (noteVal < 24)
		mark.style.boxShadow = "0px 0px 3px #ff0";
	else if (noteVal < 36)
		mark.style.boxShadow = "0px 0px 3px #0a0";
	else if (noteVal < 48)
		mark.style.boxShadow = "0px 0px 3px #00a";
	else
		mark.style.boxShadow = "0px 0px 3px #000";
	*/
	
}


function markSet(notes) {
	var fMax = 0;
	var fMin = 0;
	for (var i = 0; i < notes.length; i++) {
		if (notes[i][1] > fMax) fMax = notes[i][1];
		if (notes[i][1] < fMin) fMin = notes[i][1];
	}
	fitTo(fMax, fMin)
	for (var i = 0; i < notes.length; i++) {
		markFret(notes[i][0],notes[i][1]);
	}
}


function fitTo(highFret, lowFret) {
	zoom(1440 / (fretPos(lowFret-1) - fretPos(highFret+1)));
	var width = parseFloat(document.getElementById("guitar").style.width);
	document.getElementById("guitar").style.left = format(-1 * width * fretPos(highFret+0.5));
}
</script>

